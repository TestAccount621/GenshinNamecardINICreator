<Page x:Class="GenshinNamecardINICreator.UI.HashesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:GenshinNamecardINICreator.UI"
      xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
      xmlns:validationRules="clr-namespace:GenshinNamecardINICreator.ValidationRules"
      xmlns:mainWindow="clr-namespace:GenshinNamecardINICreator"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="500" Background="LightGray" FontSize="16"
      Title="HashesPage">
    <Page.Resources>
        <validationRules:BooleanOrConverter x:Key="BooleanOrConverter" />
        <CollectionViewSource Source="{x:Static mainWindow:MainWindow.Namecards}" 
                              x:Key="collectionView"
                              IsLiveFilteringRequested="True"
                              IsLiveSortingRequested="True">
            <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="Name" />
            </CollectionViewSource.SortDescriptions>
        </CollectionViewSource>
        <Style x:Key="textBoxBaseStyle" TargetType="{x:Type TextBox}">
            <Setter Property="Margin" Value="5" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="Height" Value="30" />
            <Setter Property="Width" Value="85" />
            <Setter Property="HorizontalAlignment" Value="Left" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Grid.Column" Value="1" />
            <Setter Property="Tag" Value="{Binding TextBoxTagValue, Mode=TwoWay}" />
            <Style.Triggers>
                <Trigger Property="Tag" Value="Edit">
                    <Setter Property="IsReadOnly" Value="False" />
                </Trigger>
                <Trigger Property="Tag" Value="New">
                    <Setter Property="IsReadOnly" Value="False" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="buttonTopRowStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="IsEnabled" Value="True" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="Edit">
                    <Setter Property="IsEnabled" Value="False" />
                </DataTrigger>
                <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="New">
                    <Setter Property="IsEnabled" Value="False" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="buttonSaveCancelStyle" TargetType="{x:Type Button}" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="Grid.Row" Value="5" />
            <Setter Property="Grid.ColumnSpan" Value="2" />
            <Setter Property="Visibility" Value="Collapsed" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="Edit">
                    <Setter Property="Visibility" Value="Visible" />
                </DataTrigger>
                <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="New">
                    <Setter Property="Visibility" Value="Visible" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <ControlTemplate x:Key="errorTemplateSilverlightStyle">
            <StackPanel Orientation="Horizontal">
                <Border BorderThickness="1" BorderBrush="#FFdc000c" CornerRadius="0.7"
                VerticalAlignment="Top">
                    <Grid>
                        <Polygon x:Name="toolTipCorner"
                         Grid.ZIndex="2"
                         Margin="-1"
                         Points="6,6 6,0 0,0" 
                         Fill="#FFdc000c" 
                         HorizontalAlignment="Right" 
                         VerticalAlignment="Top"
                         IsHitTestVisible="True"/>
                        <Polyline Grid.ZIndex="3"
                          Points="7,7 0,0" Margin="-1" HorizontalAlignment="Right" 
                          StrokeThickness="1.5"
                          StrokeEndLineCap="Round"
                          StrokeStartLineCap="Round"
                          Stroke="White"
                          VerticalAlignment="Top"
                          IsHitTestVisible="True"/>
                        <AdornedElementPlaceholder x:Name="adorner"/>
                    </Grid>
                </Border>
                <Border x:Name="errorBorder" Background="#FFdc000c" Margin="1,0,0,0"
                Opacity="0" CornerRadius="1.5"
                IsHitTestVisible="False"
                MinHeight="24" MaxWidth="267">
                    <Border.Effect>
                        <DropShadowEffect ShadowDepth="2.25" 
                                  Color="Black" 
                                  Opacity="0.4"
                                  Direction="315"
                                  BlurRadius="4"/>
                    </Border.Effect>
                    <TextBlock Text="{Binding ElementName=adorner,
                                      Path=AdornedElement.(Validation.Errors)[0].ErrorContent}"
                       Foreground="White" Margin="8,3,8,3" TextWrapping="Wrap"/>
                </Border>
            </StackPanel>
            <ControlTemplate.Triggers>
                <DataTrigger Value="True">
                    <DataTrigger.Binding>
                        <MultiBinding Converter="{StaticResource BooleanOrConverter}">
                            <Binding ElementName="adorner" Path="AdornedElement.IsKeyboardFocused" />
                            <Binding ElementName="toolTipCorner" Path="IsMouseOver"/>
                        </MultiBinding>
                    </DataTrigger.Binding>
                    <DataTrigger.EnterActions>
                        <BeginStoryboard x:Name="fadeInStoryboard">
                            <Storyboard>
                                <DoubleAnimation Duration="00:00:00.15"
                                         Storyboard.TargetName="errorBorder"
                                         Storyboard.TargetProperty="Opacity"
                                         To="1"/>
                                <ThicknessAnimation Duration="00:00:00.15"
                                            Storyboard.TargetName="errorBorder"
                                            Storyboard.TargetProperty="Margin"
                                            FillBehavior="HoldEnd"
                                            From="1,0,0,0"
                                            To="5,0,0,0">
                                    <ThicknessAnimation.EasingFunction>
                                        <BackEase EasingMode="EaseOut" Amplitude="2"/>
                                    </ThicknessAnimation.EasingFunction>
                                </ThicknessAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.EnterActions>
                    <DataTrigger.ExitActions>
                        <StopStoryboard BeginStoryboardName="fadeInStoryboard"/>
                        <BeginStoryboard x:Name="fadeOutStoryBoard">
                            <Storyboard>
                                <DoubleAnimation Duration="00:00:00"
                                         Storyboard.TargetName="errorBorder"
                                         Storyboard.TargetProperty="Opacity"
                                         To="0"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </DataTrigger.ExitActions>
                </DataTrigger>
            </ControlTemplate.Triggers>
        </ControlTemplate>
        <Style x:Key="textBoxHashesValidation" TargetType="{x:Type TextBox}" BasedOn="{StaticResource textBoxBaseStyle}">
            <Setter Property="Validation.ErrorTemplate" Value="{StaticResource errorTemplateSilverlightStyle}" />
        </Style>
        <Style TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="Grid.Column" Value="0" />
            <Setter Property="Margin" Value="5" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="HorizontalAlignment" Value="Right" />
        </Style>
    </Page.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="10" HorizontalAlignment="Center">
            <Button Content="New" Style="{StaticResource buttonTopRowStyle}" Click="Button_Click_NewOrEdit" />
            <ComboBox x:Name="cbx_KnownHashes" SelectionChanged="cbx_KnownHashes_SelectionChanged">
                <ComboBox.Style>
                    <Style TargetType="{x:Type ComboBox}">
                        <Setter Property="IsEnabled" Value="True" />
                        <Setter Property="DisplayMemberPath" Value="Name" />
                        <Setter Property="Width" Value="250" />
                        <Setter Property="Height" Value="34" />
                        <Setter Property="Margin" Value="5 0" />
                        <Setter Property="VerticalContentAlignment" Value="Center" />
                        <Setter Property="SelectedValue" Value="{Binding Selected, Mode=TwoWay}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="Edit">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding TextBoxTagValue, Mode=TwoWay}" Value="New">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ComboBox.Style>
            </ComboBox>
            <Button Content="Edit" Click="Button_Click_NewOrEdit">
                <Button.Style>
                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonTopRowStyle}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedIndex, ElementName=cbx_KnownHashes}" Value="-1">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <TextBlock Focusable="False" IsEnabled="False" Width="5" />
            <Button Content="Delete" Click="Button_Click_Delete">
                <Button.Style>
                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource buttonTopRowStyle}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedIndex, ElementName=cbx_KnownHashes}"  Value="-1">
                                <Setter Property="IsEnabled" Value="False" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>
        <TextBlock Text="Namecard Name:" Grid.Row="1" />
        <TextBlock Text="Main Hash:" Grid.Row="2" />
        <TextBlock Text="Preview Hash:" Grid.Row="3" />
        <TextBlock Text="Top Banner Hash:" Grid.Row="4" />
        <TextBox x:Name="txtBox_Name" Width="300" Grid.Row="1" Style="{StaticResource textBoxHashesValidation}">
            <TextBox.Text>
                <Binding Path="HashNameText" UpdateSourceTrigger="PropertyChanged">
                    <Binding.ValidationRules>
                        <validationRules:HashNameValidation ValidatesOnTargetUpdated="True" />
                    </Binding.ValidationRules>
                </Binding>
            </TextBox.Text>
        </TextBox>
        <TextBox x:Name="txtBox_MainHash" Grid.Row="2" 
                 Style="{StaticResource textBoxHashesValidation}">
            <TextBox.Text>
                <Binding Path="HashMainText" UpdateSourceTrigger="PropertyChanged">
                    <Binding.ValidationRules>
                        <validationRules:HashValuesTextBoxValidation ValidatesOnTargetUpdated="True" />
                    </Binding.ValidationRules>
                </Binding>
            </TextBox.Text>
        </TextBox>
        <TextBox x:Name="txtBox_PreviewHash" Grid.Row="3" 
                 Style="{StaticResource textBoxHashesValidation}">
            <TextBox.Text>
                <Binding Path="HashPreviewText" UpdateSourceTrigger="PropertyChanged">
                    <Binding.ValidationRules>
                        <validationRules:HashValuesTextBoxValidation ValidatesOnTargetUpdated="True" />
                    </Binding.ValidationRules>
                </Binding>
            </TextBox.Text>
        </TextBox>
        <TextBox x:Name="txtBox_BannerHash" Grid.Row="4" 
                 Style="{StaticResource textBoxHashesValidation}">
            <TextBox.Text>
                <Binding Path="HashBannerText" UpdateSourceTrigger="PropertyChanged">
                    <Binding.ValidationRules>
                        <validationRules:HashValuesTextBoxValidation ValidatesOnTargetUpdated="True" />
                    </Binding.ValidationRules>
                </Binding>
            </TextBox.Text>
        </TextBox>
        <Button Content="Save" Style="{StaticResource buttonSaveCancelStyle}" Margin="0,5,150,5" Click="Button_Click_Save" />
        <Button Content="Cancel" Style="{StaticResource buttonSaveCancelStyle}" Margin="150,5,0,5" Click="Button_Click_Cancel" />
    </Grid>
</Page>
